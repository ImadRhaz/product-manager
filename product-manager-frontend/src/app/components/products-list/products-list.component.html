<div class="container-fluid py-4">
  <!-- En-tête avec titre et bouton -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Liste des Produits</h2>
    </div>
    <button routerLink="/products/new" class="btn btn-primary">
      <i class="fas fa-plus me-2"></i>Nouveau Produit
    </button>
  </div>

  <!-- Affiche un message d'erreur s'il y en a -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Carte contenant le tableau -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-white py-3">
      <h5 class="card-title mb-0">
        <i class="fas fa-th me-2 text-primary"></i>
        Produits enregistrés
      </h5>
    </div>
    
    <div class="card-body p-0">
      <!-- Tableau responsive -->
      <div class="table-responsive">
        <table class="table table-hover mb-0" *ngIf="produitsSubject.value.length > 0; else noProducts">
          <thead class="table-light">
            <tr>
              <th scope="col" class="ps-4">ID</th>
              <th scope="col">Nom</th>
              <th scope="col">Prix</th>
              <th scope="col">Catégorie</th>
              <th scope="col">Référence</th>
              <th scope="col">Matricule</th>
              <th scope="col">Date Expiration</th>
              <th scope="col">Fichier</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let produit of paginatedProduits" class="align-middle">
              <td class="ps-4 fw-semibold text-muted">#{{ produit.id }}</td>
              
              <td>
                <div class="d-flex align-items-center">
                  <div class="product-avatar bg-light rounded me-3">
                    <i class="fas fa-box me-2 text-primary"></i>
                  </div>
                  <span class="fw-medium">{{ produit.nom }}</span>
                </div>
              </td>
              
              <td>
                <span class="price-badge">
                  {{ produit.prix | currency:'EUR':'symbol':'1.2-2' }}
                </span>
              </td>
              
              <td>
                <span class="badge" [ngClass]="getCategoryBadgeClass(produit.categorie)">
                  {{ produit.categorie }}
                </span>
              </td>
              
              <td>
                <span class="text-muted">{{ produit.reference || '-' }}</span>
              </td>
              
              <td>
                <span class="text-muted">{{ produit.matricule || '-' }}</span>
              </td>
              
              <td>
                <span class="text-muted">{{ produit.dateExpiration || '-' }}</span>
              </td>
              
              <td>
                <div *ngIf="produit.fileName" class="d-flex align-items-center">
                  <i class="fas fa-paperclip me-2 text-muted"></i>
                  <small class="text-truncate" style="max-width: 120px;" [title]="produit.fileName">
                    {{ produit.fileName }}
                  </small>
                </div>
                <span *ngIf="!produit.fileName" class="text-muted">-</span>
              </td>
              
              <td>
                <div class="d-flex justify-content-center gap-2">
                  <button (click)="editProduct(produit.id!)" 
                          class="btn btn-sm btn-outline-primary" 
                          title="Modifier le produit">
                    <i class="fas fa-edit"></i>
                  </button>
                  
                  <button (click)="deleteProduct(produit.id!)" 
                          class="btn btn-sm btn-outline-danger" 
                          title="Supprimer le produit">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- État vide -->
      <ng-template #noProducts>
        <div *ngIf="!error" class="text-center py-5">
          <div class="empty-state">
            <i class="fas fa-inbox display-1 text-muted"></i>
            <h4 class="mt-3 text-muted">Aucun produit trouvé</h4>
            <p class="text-muted mb-4">Commencez par créer votre premier produit</p>
            <button routerLink="/products/new" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>Créer un produit
            </button>
          </div>
        </div>
      </ng-template>

      <!-- Pagination simplifiée -->
      <div *ngIf="produitsSubject.value.length > 0" class="pagination-simple p-3 border-top">
        <div class="d-flex justify-content-center align-items-center gap-3">
          <button class="btn btn-sm btn-light" 
                  (click)="previousPage()" 
                  [disabled]="currentPage === 1">
            <i class="fas fa-arrow-left"></i>
          </button>
          
          <span class="text-muted">
            {{ currentPage }} / {{ totalPages }}
          </span>
          
          <button class="btn btn-sm btn-light" 
                  (click)="nextPage()" 
                  [disabled]="currentPage === totalPages">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        
        <div class="text-center mt-2">
          <small class="text-muted">
            {{ totalItems }} produit(s) au total
          </small>
        </div>
      </div>
    </div>
    
    <!-- Pied de tableau avec statistiques -->
    <div class="card-footer bg-light py-3" *ngIf="produitsSubject.value.length > 0">
      <div class="row align-items-center">
        <div class="col-md-6">
          <small class="text-muted">
            Page <strong>{{ currentPage }}</strong> • 
            <strong>{{ paginatedProduits.length }}</strong> produit(s) affiché(s)
          </small>
        </div>
        <div class="col-md-6 text-md-end">
          <small class="text-muted">
            Valeur totale: <strong>{{ getTotalValue(produitsSubject.value) | currency:'EUR':'symbol':'1.2-2' }}</strong>
          </small>
        </div>
      </div>
    </div>
  </div>
</div>